
groups:
- name: Persistent-Release
  jobs:
  - integration

jobs:
- name: integration
  serial: true
  plan:
  - aggregate:
    - {trigger: true,         get: emc-persistence-release}
  - task: integration
    docker-image: &docker
      platform: linux
      image_resource:
        type: docker-image
        source:
          repository: {{docker_repo}}
          insecure_registries: [{{docker_registry}}]
    config:
      <<: *docker
      inputs:
      - name: emc-persistence-release
      params:
        AWS_ACCESS_KEY: {{aws_access_key}}
        AWS_SECRET_KEY: {{aws_secret_key}}
        BOSH_URI: {{bosh_uri}}
        BOSH_USERNAME: {{bosh_username}}
        BOSH_PASSWORD: {{bosh_password}}
        BROKER_PASSWORD: {{broker_password}}
        BROKER_PLANS: {{broker_plans}}
        BROKER_PORT: {{broker_port}}
        BROKER_SERVICE_NAME: {{broker_service_name}}
        BROKER_SERVICE_UUID: {{broker_service_uuid}}
        BROKER_USERNAME: {{broker_username}}
        CF_DOMAIN: {{cf_domain}}
        CF_PASSWORD: {{cf_password}}
        CF_USERNAME: {{cf_username}}
        DIEGO_DRIVER_NAME: {{diego_driver_name}}
        LIBSTORAGE_URI: {{libstorage_uri}}
        STATIC_IP: {{static_ip}}
      run:
        path: emc-persistence-release/ci/tasks/deploy-persist-release

resources:
- name: emc-persistence-release
  type: git
  source:
    uri: https://github.com/EMC-CMD/emc-persistence-release
    branch: master
    skip_ssl_verification: true
